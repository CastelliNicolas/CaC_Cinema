<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Agregar Pelicula</title>
    <link rel="stylesheet" href="./static/css/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  </head>
  <body>
    <main class="contacto">
        <h2 class="difuminado">Agregar pelicula</h2>
        <div class="contact_form">
          <form enctype="multipart/form-data" id="formulario" onsubmit="return validarFormulario()" class="formulario">
            <label for="nombre" class="formulario-label">Nombre </label>
            <input class="formulario-input" type="text" name="nombre" id="nombre" placeholder="Nombre pelicula" />

            <label for="genero" class="formulario-label">Genero </label>
            <input class="formulario-input" type="text" name="genero" id="genero" placeholder="Genero pelicula" />

            <label for="duracion" class="formulario-label">Duracion </label>
            <input class="formulario-input" type="text" name="duracion" id="duracion" placeholder="Duracion pelicula" />

            <label for="imagen" class="formulario-label">Imagen </label>
            <input class="formulario-input" type="file" name="imagen" id="imagen" placeholder="Suba la foto" />

            <label for="atp" class="formulario-label">Apta publico </label>
            <input class="formulario-input" type="text" name="atp" id="atp" placeholder="Apta todo publico? si/no" />

            <input class="formulario-input login" type="submit" value="Agregar"></input>
            <a class="formulario-input login" href="admin.html">Volver</a>
          </form>
        </div>
    </main>
    <script>
      // const URL = "http://127.0.0.1:5000/"
      const URL = "http://sinost.pythonanywhere.com/";

      //Al subir al servidor, deberá utilizarse la siguiente ruta. USUARIO debe ser reemplazado por el nombre de usuario de Pythonanywhere
      //const URL = "https://USUARIO.pythonanywhere.com/"
      

      // Capturamos el evento de envío del formulario
      document.getElementById('formulario').addEventListener('submit', function (event) {
          event.preventDefault(); // Evitamos que se envie el form 

          var formData = new FormData(this);
  
          // Realizamos la solicitud POST al servidor
          fetch(URL + 'pelicula', {
              method: 'POST',
              body: formData // Aquí enviamos formData. Dado que formData puede contener archivos, no se utiliza JSON.
          })

          //Después de realizar la solicitud POST, se utiliza el método then() para manejar la respuesta del servidor.
          .then(function (response) {
                  if (response.ok) { 
                      //Si la respuesta es exitosa, convierte los datos de la respuesta a formato JSON.
                      return response.json(); 
                  } else {
                      // Si hubo un error, lanzar explícitamente una excepción
                      // para ser "catcheada" más adelante
                      throw new Error('Error al agregar la pelicula.');
                  }
          })

              //Respuesta OK, muestra una alerta informando que el producto se agregó correctamente y limpia los campos del formulario para que puedan ser utilizados para un nuevo producto.
              .then(function (data) {
                  alert('Pelicula agregada correctamente.');
              })

              // En caso de error, mostramos una alerta con un mensaje de error.
              .catch(function (error) {
                  alert('Error al agregar la pelicula.');
              })

              // Limpiar el formulario en ambos casos (éxito o error)
              .finally(function () {
                  document.getElementById('nombre').value = "";
                  document.getElementById('genero').value = "";
                  document.getElementById('duracion').value = "";
                  document.getElementById('imagen').value = "";
                  document.getElementById('atp').value = "";
              });
      })
  </script>
    <script src="static/JS/main.js"></script>
  </body>
</html>
